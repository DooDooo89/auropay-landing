<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Payment Processor</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
</head>
<body>
  <h2>Payment Processor (Polygon Amoy Testnet)</h2>

  <!-- Connect Wallet -->
  <button id="connect">Connect Wallet</button>
  <p id="account">Not connected</p>

  <!-- Balance -->
  <p>Contract Balance: <span id="balance">0</span> POL</p>
  <button id="refresh">Refresh Balance</button>

  <!-- Pay -->
  <h3>Send Payment</h3>
  <input type="text" id="payAmount" placeholder="Amount in POL">
  <button id="pay">Pay</button>

  <!-- Withdraw -->
  <h3>Withdraw</h3>
  <button id="withdrawAll">Withdraw All (Owner)</button>

  <script>
    // ⚠️ Replace with your deployed contract address
    const contractAddress = "0x4D8B6e01750Ca97ed8316290D586f1EE632F9146";

    // ✅ Full ABI from PaymentProcessor.sol
    const contractABI = [
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "PaymentReceived",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "Withdrawal",
        "type": "event"
      },
      {
        "inputs": [],
        "name": "getBalance",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "pay",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "withdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "withdrawAll",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let provider, signer, contract;

    // Connect wallet
    document.getElementById("connect").onclick = async () => {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("account").innerText = "Connected: " + address;

        contract = new ethers.Contract(contractAddress, contractABI, signer);
      } else {
        alert("MetaMask not found");
      }
    };

    // Refresh balance
    document.getElementById("refresh").onclick = async () => {
      if (!contract) return alert("Connect wallet first");
      const balance = await contract.getBalance();
      document.getElementById("balance").innerText = ethers.utils.formatEther(balance);
    };

    // Pay
    document.getElementById("pay").onclick = async () => {
      if (!contract) return alert("Connect wallet first");
      const amount = document.getElementById("payAmount").value;
      const tx = await contract.pay({ value: ethers.utils.parseEther(amount) });
      await tx.wait();
      alert("Payment successful!");
    };

    // Withdraw all
    document.getElementById("withdrawAll").onclick = async () => {
      if (!contract) return alert("Connect wallet first");
      const tx = await contract.withdrawAll();
      await tx.wait();
      alert("Withdrawal complete!");
    };
  </script>
</body>
</html>


