<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payment Processor (Polygon Amoy Testnet)</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h2>Payment Processor (Polygon Amoy Testnet)</h2>

  <!-- Connect Wallet -->
  <button id="connectButton">Connect Wallet</button>
  <p id="walletAddress">Not connected</p>

  <!-- Contract Balance -->
  <p>Contract Balance: <span id="contractBalance">0</span> POL</p>
  <button id="refreshBalance">Refresh Balance</button>

  <!-- Send Payment -->
  <h3>Send Payment</h3>
  <input type="text" id="payAmount" placeholder="Amount in POL">
  <button id="payButton">Pay</button>

  <!-- Withdraw -->
  <h3>Withdraw</h3>
  <button id="withdrawAll">Withdraw All (Owner)</button>

  <script>
    // ✅ Your deployed contract address (replace if redeployed)
    const contractAddress = "0x4d8b6e01750ca97ed8316290d586f1ee632f9146";

    // ✅ Full ABI from PaymentProcessor.sol
    const contractABI = [
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "from", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "PaymentReceived",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "to", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "WithdrawAll",
        "type": "event"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "withdrawAll",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "pay",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "stateMutability": "payable",
        "type": "receive"
      }
    ];

    let provider;
    let signer;
    let contract;

    // ✅ Connect Wallet
    document.getElementById("connectButton").onclick = async () => {
      if (typeof window.ethereum === "undefined") {
        alert("MetaMask not found. Please install it.");
        return;
      }
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      const addr = await signer.getAddress();
      document.getElementById("walletAddress").innerText = "Connected: " + addr;

      contract = new ethers.Contract(contractAddress, contractABI, signer);
    };

    // ✅ Refresh Balance
    document.getElementById("refreshBalance").onclick = async () => {
      if (!contract) return alert("Connect wallet first.");
      const balance = await provider.getBalance(contractAddress);
      document.getElementById("contractBalance").innerText = ethers.utils.formatEther(balance);
    };

    // ✅ Send Payment
    document.getElementById("payButton").onclick = async () => {
      if (!signer) return alert("Connect wallet first.");
      const amount = document.getElementById("payAmount").value;
      if (!amount || isNaN(amount)) return alert("Enter a valid number.");
      try {
        const tx = await signer.sendTransaction({
          to: contractAddress,
          value: ethers.utils.parseEther(amount)
        });
        await tx.wait();
        alert("Payment sent!");
      } catch (err) {
        console.error(err);
        alert("Payment failed: " + err.message);
      }
    };

    // ✅ Withdraw All (Owner only)
    document.getElementById("withdrawAll").onclick = async () => {
      if (!contract) return alert("Connect wallet first.");
      try {
        const tx = await contract.withdrawAll();
        await tx.wait();
        alert("Withdraw successful!");
      } catch (err) {
        console.error(err);
        alert("Withdraw failed: " + err.message);
      }
    };
  </script>
</body>
</html>







